<%- include('../partials/header', { currentPage: 'products' }) %>

    <!-- Page Header -->
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 animate-fade-in-up">
        <div>
            <h1 class="text-2xl font-semibold tracking-tight text-primary-900">Chỉnh sửa sản phẩm</h1>
            <p class="text-sm text-slate-500 mt-1">
                <%= product.name %>
            </p>
        </div>
        <div class="flex gap-2">
            <a href="/products/<%= product.slug %>" target="_blank" class="btn-secondary flex items-center gap-2">
                <iconify-icon icon="lucide:eye" width="18"></iconify-icon>
                Xem
            </a>
            <a href="/admin/products" class="btn-secondary flex items-center gap-2">
                <iconify-icon icon="lucide:arrow-left" width="18"></iconify-icon>
                Quay lại
            </a>
        </div>
    </div>

    <form action="/admin/products/<%= product._id %>?_method=PUT" method="POST" enctype="multipart/form-data"
        class="space-y-6 animate-fade-in-up" style="animation-delay: 100ms;">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Info -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h2 class="text-base font-semibold text-slate-900 mb-4">Thông tin cơ bản</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Tên sản phẩm *</label>
                            <input type="text" name="name" required class="input-field" value="<%= product.name %>">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">SKU</label>
                                <input type="text" name="sku" class="input-field" value="<%= product.sku || '' %>">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Thương hiệu</label>
                                <select name="brand" class="input-field">
                                    <option value="">Chọn thương hiệu</option>
                                    <% brands.forEach(b=> { %>
                                        <option value="<%= b %>" <%=product.brand===b ? 'selected' : '' %>><%= b %>
                                        </option>
                                        <% }); %>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Mô tả ngắn</label>
                            <input type="text" name="shortDescription" class="input-field"
                                value="<%= product.shortDescription || '' %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Mô tả chi tiết</label>
                            <textarea name="description" rows="4"
                                class="input-field"><%= product.description || '' %></textarea>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h2 class="text-base font-semibold text-slate-900 mb-4">Thông số kỹ thuật</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Bộ máy</label>
                            <select name="specifications[movement]" class="input-field">
                                <% movements.forEach(m=> { %>
                                    <option value="<%= m %>" <%=product.specifications &&
                                        product.specifications.movement===m ? 'selected' : '' %>><%= m %>
                                    </option>
                                    <% }); %>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Kích thước mặt</label>
                            <input type="text" name="specifications[caseSize]" class="input-field"
                                value="<%= product.specifications ? product.specifications.caseSize || '' : '' %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Chất liệu vỏ</label>
                            <input type="text" name="specifications[caseMaterial]" class="input-field"
                                value="<%= product.specifications ? product.specifications.caseMaterial || '' : '' %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Chất liệu dây</label>
                            <input type="text" name="specifications[bandMaterial]" class="input-field"
                                value="<%= product.specifications ? product.specifications.bandMaterial || '' : '' %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Kháng nước</label>
                            <input type="text" name="specifications[waterResistance]" class="input-field"
                                value="<%= product.specifications ? product.specifications.waterResistance || '' : '' %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Loại kính</label>
                            <input type="text" name="specifications[crystalType]" class="input-field"
                                value="<%= product.specifications ? product.specifications.crystalType || '' : '' %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Giới tính</label>
                            <select name="specifications[gender]" class="input-field">
                                <% genders.forEach(g=> { %>
                                    <option value="<%= g %>" <%=product.specifications &&
                                        product.specifications.gender===g ? 'selected' : '' %>><%= g %>
                                    </option>
                                    <% }); %>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Phong cách</label>
                            <select name="specifications[style]" class="input-field">
                                <% styles.forEach(s=> { %>
                                    <option value="<%= s %>" <%=product.specifications &&
                                        product.specifications.style===s ? 'selected' : '' %>><%= s %>
                                    </option>
                                    <% }); %>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h2 class="text-base font-semibold text-slate-900 mb-4">Tính năng</h2>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Tính năng nổi bật (mỗi dòng 1 tính
                            năng)</label>
                        <textarea name="features" rows="4"
                            class="input-field"><%= product.features ? product.features.join('\n') : '' %></textarea>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h2 class="text-base font-semibold text-slate-900 mb-4">Giá & Kho</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Giá bán *</label>
                            <input type="number" name="price" required class="input-field" value="<%= product.price %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Giá khuyến mãi</label>
                            <input type="number" name="salePrice" class="input-field"
                                value="<%= product.salePrice || '' %>">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Số lượng tồn kho *</label>
                            <input type="number" name="stock" required class="input-field" value="<%= product.stock %>">
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h2 class="text-base font-semibold text-slate-900 mb-4">Phân loại</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Danh mục *</label>
                            <select name="category" required class="input-field">
                                <option value="">Chọn danh mục</option>
                                <% categories.forEach(cat=> { %>
                                    <option value="<%= cat._id %>" <%=product.category &&
                                        product.category._id.toString()===cat._id.toString() ? 'selected' : '' %>><%=
                                            cat.name %>
                                    </option>
                                    <% }); %>
                            </select>
                        </div>
                        <div class="flex items-center gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" name="isActive" value="true" <%=product.isActive ? 'checked' : ''
                                    %> class="rounded border-slate-300 text-primary-600 focus:ring-primary-500">
                                <span class="text-sm text-slate-700">Đang bán</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" name="isFeatured" value="true" <%=product.isFeatured ? 'checked'
                                    : '' %> class="rounded border-slate-300 text-primary-600 focus:ring-primary-500">
                                <span class="text-sm text-slate-700">Nổi bật</span>
                            </label>
                        </div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="isNewArrival" value="true" <%=product.isNewArrival ? 'checked'
                                : '' %> class="rounded border-slate-300 text-primary-600 focus:ring-primary-500">
                            <span class="text-sm text-slate-700">Sản phẩm mới</span>
                        </label>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                    <h2 class="text-base font-semibold text-slate-900 mb-4">Hình ảnh hiện tại</h2>
                    <% if (product.images && product.images.length> 0) { %>
                        <div class="grid grid-cols-3 gap-2 mb-4">
                            <% product.images.forEach(img=> { %>
                                <div class="aspect-square rounded-lg overflow-hidden bg-slate-100">
                                    <img src="<%= img.url %>" class="w-full h-full object-cover" alt="">
                                </div>
                                <% }); %>
                        </div>
                        <% } else { %>
                            <p class="text-sm text-slate-400 mb-4">Chưa có ảnh</p>
                            <% } %>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Upload ảnh mới</label>
                                    <input type="file" name="images" multiple accept="image/*"
                                        class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100 cursor-pointer">
                                </div>
                </div>

                <button type="submit" class="w-full btn-primary py-3 text-base">
                    <iconify-icon icon="lucide:save" width="18" class="mr-2"></iconify-icon>
                    Lưu thay đổi
                </button>
            </div>
        </div>
    </form>

    <%- include('../partials/footer') %>