<%- include('../partials/header', { currentPage: 'categories' }) %>

    <!-- Page Header -->
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 animate-fade-in-up">
        <div>
            <h1 class="text-2xl font-semibold tracking-tight text-primary-900">Quản lý danh mục</h1>
            <p class="text-sm text-slate-500 mt-1">Tổng cộng <span class="font-medium text-slate-700">
                    <%= categories.length %>
                </span> danh mục</p>
        </div>
        <button onclick="document.getElementById('createModal').classList.remove('hidden')"
            class="btn-primary flex items-center gap-2">
            <iconify-icon icon="lucide:plus" width="18"></iconify-icon>
            Thêm danh mục
        </button>
    </div>

    <!-- Categories Table -->
    <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden animate-fade-in-up"
        style="animation-delay: 100ms;">
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
                <thead class="text-xs text-slate-500 uppercase bg-slate-50/50 border-b border-slate-100 font-semibold">
                    <tr>
                        <th class="px-4 py-3 w-12">STT</th>
                        <th class="px-4 py-3">Tên danh mục</th>
                        <th class="px-4 py-3">Slug</th>
                        <th class="px-4 py-3">Số sản phẩm</th>
                        <th class="px-4 py-3">Nổi bật</th>
                        <th class="px-4 py-3">Trạng thái</th>
                        <th class="px-4 py-3 text-right">Hành động</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    <% if (categories && categories.length> 0) { %>
                        <% categories.forEach((cat, index)=> { %>
                            <tr class="hover:bg-slate-50/80 transition-colors">
                                <td class="px-4 py-3 text-slate-500">
                                    <%= index + 1 %>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-primary-50 text-primary-600 flex items-center justify-center">
                                            <iconify-icon icon="lucide:folder" width="20"></iconify-icon>
                                        </div>
                                        <div>
                                            <div class="font-medium text-slate-900">
                                                <%= cat.name %>
                                            </div>
                                            <div class="text-xs text-slate-500">
                                                <%= cat.description ? cat.description.substring(0, 50) + '...' : '' %>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 font-mono text-xs text-slate-500">
                                    <%= cat.slug %>
                                </td>
                                <td class="px-4 py-3 text-slate-600">
                                    <%= cat.productCount || 0 %>
                                </td>
                                <td class="px-4 py-3">
                                    <% if (cat.isFeatured) { %>
                                        <iconify-icon icon="lucide:star" class="text-yellow-500"
                                            width="18"></iconify-icon>
                                        <% } else { %>
                                            <iconify-icon icon="lucide:star" class="text-slate-300"
                                                width="18"></iconify-icon>
                                            <% } %>
                                </td>
                                <td class="px-4 py-3">
                                    <span
                                        class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium <%= cat.isActive ? 'bg-emerald-50 text-emerald-700' : 'bg-slate-100 text-slate-500' %>">
                                        <%= cat.isActive ? 'Hoạt động' : 'Ẩn' %>
                                    </span>
                                </td>
                                <td class="px-4 py-3 text-right">
                                    <button onclick="deleteCategory('<%= cat._id %>')"
                                        class="text-xs text-red-600 hover:text-red-700 font-medium">
                                        Xóa
                                    </button>
                                </td>
                            </tr>
                            <% }); %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="7" class="px-4 py-12 text-center text-slate-400">
                                            <iconify-icon icon="lucide:folder" width="48" class="mb-2"></iconify-icon>
                                            <p>Chưa có danh mục nào</p>
                                        </td>
                                    </tr>
                                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Create Modal -->
    <div id="createModal"
        class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
            <div class="p-6 border-b border-slate-100 flex items-center justify-between">
                <h2 class="text-lg font-semibold text-slate-900">Thêm danh mục mới</h2>
                <button onclick="document.getElementById('createModal').classList.add('hidden')"
                    class="text-slate-400 hover:text-slate-600">
                    <iconify-icon icon="lucide:x" width="20"></iconify-icon>
                </button>
            </div>
            <form action="/admin/categories" method="POST" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Tên danh mục *</label>
                    <input type="text" name="name" required class="input-field" placeholder="VD: Đồng hồ nam">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Mô tả</label>
                    <textarea name="description" rows="3" class="input-field"
                        placeholder="Mô tả danh mục..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Thứ tự hiển thị</label>
                    <input type="number" name="order" class="input-field" value="0">
                </div>
                <div class="flex items-center gap-4">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" name="isActive" value="true" checked
                            class="rounded border-slate-300 text-primary-600">
                        <span class="text-sm text-slate-700">Hoạt động</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" name="isFeatured" value="true"
                            class="rounded border-slate-300 text-primary-600">
                        <span class="text-sm text-slate-700">Nổi bật</span>
                    </label>
                </div>
                <button type="submit" class="w-full btn-primary py-2.5">Thêm danh mục</button>
            </form>
        </div>
    </div>

    <script>
        async function deleteCategory(id) {
            if (!confirm('Bạn có chắc muốn xóa danh mục này?')) return;
            try {
                const res = await fetch(`/admin/categories/${id}`, { method: 'DELETE' });
                const data = await res.json();
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.message || 'Có lỗi xảy ra');
                }
            } catch (e) {
                alert('Có lỗi xảy ra');
            }
        }
    </script>

    <%- include('../partials/footer') %>